# 토비의 스프링 6일차

## 2.1 UserDaoTest 다시 보기

### 2.1.1 테스트의 유용성

`테스트란 내가 예상하고 의도했던 대로 코드가 정확히 동작하는지 확인해서, 만든 코드를 확신할 수 있게 해주는 작업이다.` 또한 테스트의 결과가 원하는 대로 나오지 않는 경우에는 코드나 설계에 결함이 있음을 알 수 있다. 테스트를 통해 결함을 제거하는 작업, 일명 디버깅을 거치게 되고, 최종적으로 테스트가 성공하면 모든 결함에 제거됐다는 확신을 얻을 수 있다.

### 2.1.2 UserDaoTest의 특징

**main() 메소드로 작성된 테스트**
```java
import org.springframework.context.support.GenericXmlApplicationContext;

public class UserDaoTest {

  public static void main(String[] args) {
    ApplicationContext context = new GenericXmlApplicationContext("applicationContext.xml");

    UserDao dao = context.getBean("userDao", UserDao.class);
    
    User user = new User();
    user.setId("user");
    user.setName("kim");
    user.setPassword("1234");

    dao.add(user);

    System.out.println(user.getId() + "등록 성공");

    User user2 = dao.get(user.getId());
    System.out.println(user2.getName());
    System.out.println(user2.getPassword());

    System.out.println(user2.getId() + "조회 성공");
  }
}
```

이 테스트 코드의 내용을 정리해보면 다음과 같다.
- 자바에서 손쉽게 실행 가능한 main() 메소드를 사용한다.
- 테스트할 대상인 UserDao의 오브젝트를 가져와 메소드 호출한다.
- 테스트에 사용할 입력 값을 직접 코드에서 만들어서 넣어준다.
- 테스트의 결과를 콘솔에 출력해준다.
- 각 단계의 작업이 에러 없이 끝나면 콘솔에 성공 메시지로 출력해준다.

이 테스트 방법에서 가장 돋보이는 건, main() 메소드를 사용하여 쉽게 테스트 수행을 가능하게 했다는 점과 테스트할 대상인 UserDao를 직접 호출해서 사용한다는 점이다.

### 웹을 통한 DAO 테스트 방법의 문제점

보통 웹 프로그램에서 사용하는 DAO를 테스트하는 방법은 다음과 같다.
- 서비스, MVC 프레젠테이션 계층까지 포함한 코드를 만든다.
- 이렇게 만들어진 테스트용 웹 애플리케이션을 서버에 배치한다.
- 웹 화면을 띄워서 UI 조작을 통해 실제 서버와 통신을 해본다.

이렇게 웹 화면을 통해 결과를 확인하는 방법은 가장 흔히 쓰이지만, DAO에 대한 테스트로서는 단점이 너무 많다. `DAO뿐만 아니라 서비스, 컨트롤러, 뷰 등 모든 레이어의 기능을 다 만들고 나서야 테스트가 가능하다는 점이 가장 큰 문제다.` 또한 컨트롤러, 서비스와 같이 참여하는 클래스가 많기 때문에 테스트를 하는 중에 에러 또는 실패가 발생한다면 어디서 문제가 발생했는지 원인을 빠르게 찾기 힘들다는 문제도 있다.

### 작은 단위의 테스트

한꺼번에 너무 많은 것을 몰아서 테스트하면 테스트 수행 과정도 복잡해지고, 오류가 발생했을 때 정확한 원인을 찾기가 힘들어진다. 따라서 `테스트는 가능하면 작은 단위로 쪼개서 집중해서 할 수 있어야 한다.` 관심사의 분리라는 원리가 여기에도 적용된다.

이렇게 작은 단위의 코드로 쪼개서 테스트를 수행한 것을 `단위 테스트(Unit Test)` 라고 한다. 단위의 범위는 딱 정해진 것이 아니다. 크게는 사용자 관리 기능을 모두 통틀어서 하나의 단위로 볼 수 있고, 작게 보면 메소드 하나만을 가지고 하나의 단위로 생각할 수도 있다. `충분히 하나의 관심에 집중해서 효율적으로 테스트할 만한 범위의 단위라고 보면 된다.` **일반적으로는 단위는 작을수록 좋다.**

때로는 웹 사용자 인터페이스부터 시작해서 DB에 이르기까지의 애플리케이션 전 계층이 참여하고, 또 단순 사용자 등록 작업 하나가 아니라, 초기 등록에서부터 시작해서 등록 -> 로그인 -> 로그아웃 까지 전 과정을 하나로 묶어서 테스트할 필요가 있다. 각 단위 기능은 잘 동작하지만 묶어놓으면 잘 안되는 경우가 발생하기 때문이다.

이렇게 작은 단위로 나눠서 테스트하는 단위 테스트가 필요한 이유는 무엇일까? `단위 테스트를 하는 이유는 개발자가 설계하고 만든 코드가 원래 의도한 대로 동작하는지를 개발자 스스로 빨리 확인받기 위해서다.` 이러한 이유 때문에 개발자 테스트 또는 프로그래머 테스트라고도 한다. 물론 개발자가 아닌 전문 테스터나 고객이 직접 단위 테스트를 할 수 있지만 단위가 제법 커질 것이다.

### 자동수행 테스트 코드

매번 웹 화면에 폼을 띄워 실제 UI 조작을 통해 테스트를 한다면 매우 번거로울 것이다.

하지만 UserDaoTest는 자바 클래스의 main() 메소드를 실행하는 가장 간단한 방법만으로 테스트의 전 과정이 자동으로 진행된다. 번거롭게 매번 입력할 필요도 없고, 테스트를 위해 서버를 띄우고, 브라우저를 열어야 하는 불편함도 없다. 그리고 테스트 진행시간도 매우 짧기 때문에 자주 수행해도 부담이 없다. 그런데 애플리케이션을 구성하는 클래스 안에 코드를 포함시키는 것보다는 별도로 테스트용 클래스를 만들어서 테스트 코드를 넣는 편이 낫다.

자동으로 수행되는 테스트의 장점은 자주 반복할 수 있다는 것이다. 번거로운 작업이 없고 빠르게 실행할 수 있기 때문에 언제든 코드를 수정하고 나서 테스트를 해볼 수 있다. 또한 운영 중인 상황에서 코드를 수정하려고 할 때 코드를 수정한 후 만들어둔 테스트를 수정하여 문제가 없는지 재빨리 확인도 가능하다.

### 2.1.3 UserDaoTest의 문제점

앞에서 살펴봤듯이 UI까지 동원되는 번거로운 테스트에 비해 장점이 많은 건 사실이다. 하지만 만족스럽지 못한 부분도 있다.

- 수동 확인 작업의 번거로움
  - User 정보를 DB에 등록하고, 이를 다시 get()을 이용해 가져왔을 때 입력한 값과 가져온 값이 일치하는지를 테스트 코드는 확인해주지 않는다. 단지 콘솔에 값을 출력할 뿐이다. 결국 그 콘솔에 나온 값을 보고 등록과 조회가 성공적으로 되고 있는지를 확인하는 건 사람의 책임이다. 검증해야 하는 양이 많고 복잡해지면 불편함을 느낄 수 밖에 없고 실수를 할 가능성도 있다.
- 실행 작업의 번거로움
  - 아무리 간단히 실행 가능한 main() 메소드라고 하더라도 매번 그것을 실행하는 것은 제법 번거롭다.
